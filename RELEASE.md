Release type: minor

Completely rewrite code and add unit tests.
